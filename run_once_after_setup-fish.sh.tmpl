#!/bin/bash

set -eufo pipefail

echo "==> Configuring Fish shell..."

# Check if fish is installed
if ! command -v fish &>/dev/null; then
    echo "Fish is not installed. Skipping..."
    exit 0
fi

FISH_PATH=$(which fish)

# Add fish to /etc/shells if not already present
if ! grep -q "$FISH_PATH" /etc/shells; then
    echo "Adding fish to /etc/shells..."
    echo "$FISH_PATH" | sudo tee -a /etc/shells
fi

# Set fish as default shell if not already set
if [ "$SHELL" != "$FISH_PATH" ]; then
    echo "Setting fish as default shell..."
    chsh -s "$FISH_PATH"
    echo "Default shell changed to fish. Please restart your terminal."
else
    echo "Fish is already the default shell."
fi

# Install Fisher (Fish plugin manager) if not already installed
if ! fish -c 'type -q fisher' &>/dev/null; then
    echo "Installing Fisher..."
    fish -c 'curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | source && fisher install jorgebucaran/fisher'
fi

echo "==> Fish configuration complete!"
