##### ------------------------------------------------------------
##### Minimal, fast, no-plugins tmux config
##### ------------------------------------------------------------

# --- Prefix (Ctrl-a) ---
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded"

# If you use ~/.tmux.conf instead, comment above and use:
# bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

# --- Quality of life ---
set -g mouse on
setw -g mode-keys vi

# Start window/pane numbering at 1 (more human-friendly)
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Reduce ESC delay in (neo)vim inside tmux
# This is a common fix for delayed ESC key behavior.
set -sg escape-time 0

# Larger scrollback
set -g history-limit 50000

# --- True color / modern terminal support ---
# Try to keep colors correct in modern terminals.
# (Works well on iTerm2 / Alacritty / Kitty / Ghostty etc.)
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
# Some setups prefer RGB capability explicitly:
# set -ga terminal-overrides ",xterm-256color:RGB"

# --- Splits (ergonomic) ---
unbind '"'
unbind %
bind | split-window -h
bind - split-window -v
bind c new-window

# --- Pane navigation (Vim-like) ---
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 3
bind -r K resize-pane -U 3
bind -r L resize-pane -R 5

# Quick swap panes
bind < swap-pane -U
bind > swap-pane -D

# --- Copy mode: Vim-like selection + system clipboard ---
# Enter copy-mode: prefix + [
bind [ copy-mode

# Selection keys
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Copy to system clipboard (macOS / Wayland / X11)
# tmux 2.6+ supports copy-pipe-and-cancel with pbcopy directly on macOS.
# We'll detect tools at runtime.
bind -T copy-mode-vi y run-shell -b ' \
  if command -v pbcopy >/dev/null 2>&1; then \
    tmux send -X copy-pipe-and-cancel "pbcopy"; \
  elif command -v wl-copy >/dev/null 2>&1; then \
    tmux send -X copy-pipe-and-cancel "wl-copy"; \
  elif command -v xclip >/dev/null 2>&1; then \
    tmux send -X copy-pipe-and-cancel "xclip -in -selection clipboard"; \
  else \
    tmux display-message "No clipboard tool found (pbcopy/wl-copy/xclip)"; \
  fi'

# Also copy on Enter (nice when your muscle memory is Enter)
bind -T copy-mode-vi Enter run-shell -b ' \
  if command -v pbcopy >/dev/null 2>&1; then \
    tmux send -X copy-pipe-and-cancel "pbcopy"; \
  elif command -v wl-copy >/dev/null 2>&1; then \
    tmux send -X copy-pipe-and-cancel "wl-copy"; \
  elif command -v xclip >/dev/null 2>&1; then \
    tmux send -X copy-pipe-and-cancel "xclip -in -selection clipboard"; \
  else \
    tmux display-message "No clipboard tool found (pbcopy/wl-copy/xclip)"; \
  fi'

# Optional: paste from system clipboard to tmux (prefix + p)
bind p run-shell -b ' \
  if command -v pbpaste >/dev/null 2>&1; then \
    pbpaste | tmux load-buffer - \; paste-buffer; \
  elif command -v wl-paste >/dev/null 2>&1; then \
    wl-paste | tmux load-buffer - \; paste-buffer; \
  elif command -v xclip >/dev/null 2>&1; then \
    xclip -out -selection clipboard | tmux load-buffer - \; paste-buffer; \
  else \
    tmux display-message "No clipboard tool found (pbpaste/wl-paste/xclip)"; \
  fi'

# --- Status line (clean & readable) ---
set -g status on
set -g status-interval 5
set -g status-left-length 40
set -g status-right-length 120
set -g status-left " #[bold]#S #[default]"
set -g status-right " %Y-%m-%d %H:%M "

# --- Safer clipboard integration (optional) ---
# tmux has a built-in set-clipboard option, but note the security implications:
# with set-clipboard on (tmux 2.6+), any program running inside tmux can set OS clipboard.
# See tmux wiki for details.
# set -g set-clipboard on

